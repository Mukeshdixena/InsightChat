<!-- Floating Button -->
<div class="ai-fab" (click)="toggleWidget()" [class.open]="isOpen">
    <span class="fab-icon" *ngIf="!isOpen">ðŸ¤–</span>
    <span class="fab-icon close" *ngIf="isOpen">âœ•</span>
</div>

<!-- Chat Popup -->
<div class="ai-popup" *ngIf="isOpen">
    <div class="popup-header">
        <div class="header-info">
            <span class="bot-avatar">ðŸ¤–</span>
            <div class="bot-details">
                <h4>AI Assistant</h4>
                <span class="status">Online â€¢ Powered by Gemini</span>
            </div>
        </div>
        <div class="header-actions">
            <!-- 3 Dot Menu Trigger -->
            <span class="menu-trigger" (click)="toggleMenu($event)">â‹®</span>

            <!-- Dropdown Menu -->
            <div class="header-menu-dropdown" *ngIf="showMenu">
                <div class="menu-item" (click)="clearChat()">
                    <span>Clear Chat</span>
                </div>
            </div>
        </div>
    </div>

    <div class="popup-body" #scrollContainer>
        <div *ngIf="loading" class="loading-state">Connecting...</div>

        <div *ngIf="!loading && messages.length === 0" class="welcome-state">
            <p>ðŸ‘‹ Hi! I'm your AI assistant.</p>
            <p>Ask me anything!</p>
        </div>

        <div *ngFor="let msg of messages" class="message" [class.sent]="isMyMessage(msg)">
            <div class="message-content">
                {{ msg.content }}

                <!-- Message Status Indicators (only for sent messages) -->
                <span class="message-status" *ngIf="isMyMessage(msg)">
                    <span *ngIf="getMessageStatus(msg) === 'sent'" class="status-tick">âœ“</span>
                    <span *ngIf="getMessageStatus(msg) === 'delivered'" class="status-tick">âœ“âœ“</span>
                    <span *ngIf="getMessageStatus(msg) === 'read'" class="status-tick read">âœ“âœ“</span>
                </span>
            </div>
        </div>
    </div>

    <div class="popup-footer">
        <input [(ngModel)]="newMessage" (keydown.enter)="sendMessage()" placeholder="Ask a question..." autoFocus />
        <button (click)="sendMessage()" [disabled]="!newMessage.trim()">
            âž¤
        </button>
    </div>
</div>