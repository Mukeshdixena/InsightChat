<div class="chat-list-container">

    <app-create-group *ngIf="showCreateGroup" (groupCreated)="onGroupCreated($event)"
        (cancelCreate)="cancelCreateGroup()"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;">
    </app-create-group>

    <app-start-chat *ngIf="showStartChat" (chatStarted)="onChatStarted($event)" (cancelStart)="cancelStartChat()"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;">
    </app-start-chat>

    <app-profile-drawer *ngIf="showProfileDrawer" (closeDrawer)="closeProfile()"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 20;">
    </app-profile-drawer>

    <div class="header">
        <div class="user-profile" (click)="openProfile()" style="cursor: pointer;">
            <div class="avatar">{{ currentUser?.username?.charAt(0)?.toUpperCase() || 'Me' }}</div>
            <!-- Display current user name if available, e.g. {{ currentUser?.username }} -->
        </div>
        <div class="actions">
            <button (click)="createGroup()" title="New Group" class="icon-btn">+</button>
            <button (click)="startChat()" title="New Chat" class="icon-btn">âœŽ</button>
        </div>
    </div>

    <div class="search-bar">
        <input type="text" [(ngModel)]="searchText" placeholder="Search or start new chat" />
    </div>

    <div class="chats">
        <div *ngFor="let chat of filteredChats" class="chat-item" [class.active]="chat._id === selectedChatId"
            (click)="selectChat(chat)">
            <div class="avatar">{{ getChatName(chat).charAt(0).toUpperCase() }}</div>
            <div class="chat-info">
                <div class="chat-header">
                    <div class="chat-name">{{ getChatName(chat) }}</div>
                    <span class="badge" *ngIf="chat.unreadCount && chat.unreadCount > 0">{{ chat.unreadCount }}</span>
                </div>
                <div class="last-message">
                    {{ chat.latestMessage?.content || "No messages yet" }}
                </div>
            </div>
        </div>
    </div>
</div>